-- Load Rayfield UI
local success, Rayfield = pcall(function()
    return loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
end)
if not success then
    warn("Kh√¥ng th·ªÉ t·∫£i Rayfield UI: " .. tostring(err))
    game.StarterGui:SetCore("SendNotification", {
        Title = "L·ªói Script",
        Text = "Kh√¥ng t·∫£i ƒë∆∞·ª£c Rayfield UI: " .. tostring(err) .. ". Ki·ªÉm tra m·∫°ng ho·∫∑c URL!",
        Duration = 10
    })
    return
end

-- Khai b√°o bi·∫øn
local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid", 5) -- Th√™m timeout ƒë·ªÉ tr√°nh l·ªói nil
local rootPart = character:WaitForChild("HumanoidRootPart", 5)
local fastAttackEnabled = false
local autoFruitEnabled = false
local fastAttackThread

-- T·∫°o Window Rayfield (hi·ªÉn th·ªã ban ƒë·∫ßu)
local Window = Rayfield:CreateWindow({
    Name = "Beta Hubüí∏",
    LoadingTitle = "ƒêang t·∫£i...",
    LoadingSubtitle = "Your mom",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "BetaHubConfig",
        FileName = "BetaHub"
    },
    Discord = {
        Enabled = false,
        Invite = "discord.gg/123456789",
        RememberJoins = true
    },
    KeySystem = false,
    KeySettings = {
        Title = "Beta Hub Key",
        Subtitle = "Nh·∫≠p kh√≥a ƒë·ªÉ ti·∫øp t·ª•c",
        Note = "Li√™n h·ªá admin ƒë·ªÉ l·∫•y kh√≥a",
        FileName = "BetaHubKey",
        SaveKey = true,
        GrabKeyFromSite = false,
        Key = {"Hello"}
    }
})

-- T·∫°o Tab trong Rayfield
local MainTab = Window:CreateTab("Ch√≠nh", 4483345998)
local CustomizeTab = Window:CreateTab("T√πy Ch·ªânh", 4483345998)

-- Section cho Controls
local MainSection = MainTab:CreateSection("T√≠nh NƒÉng")

-- H√†m c·∫≠p nh·∫≠t nh√¢n v·∫≠t
local function updateCharacter()
    character = player.Character or player.CharacterAdded:Wait()
    humanoid = character:WaitForChild("Humanoid", 5)
    rootPart = character:WaitForChild("HumanoidRootPart", 5)
end
player.CharacterAdded:Connect(updateCharacter)

-- H√†m Fast Attack (T·ªëc ƒë·ªô t·ªëi ∆∞u cho mobile: 0.001s)
local function startFastAttack()
    if fastAttackThread then
        task.cancel(fastAttackThread)
        fastAttackThread = nil
    end
    
    local tool = character:FindFirstChildOfClass("Tool")
    if not tool then
        fastAttackEnabled = false
        MainSection:CreateToggle({
            Name = "Fast Attack",
            CurrentValue = false,
            Flag = "FastAttackToggle",
            Callback = function() end
        }):Set(false)
        return
    end

    fastAttackThread = task.spawn(function()
        while fastAttackEnabled and character and humanoid.Health > 0 do
            local currentTool = character:FindFirstChildOfClass("Tool")
            if currentTool then
                currentTool:Activate()
            else
                fastAttackEnabled = false
                break
            end
            task.wait(0.001) -- T·ªëc ƒë·ªô t·ªëi ∆∞u cho mobile, tr√°nh lag
        end
    end)
end

local function stopFastAttack()
    if fastAttackThread then
        task.cancel(fastAttackThread)
        fastAttackThread = nil
    end
end

-- H√†m Auto Fruit (TƒÉng wait ƒë·ªÉ t·ªëi ∆∞u mobile)
local function autoFruit()
    local debounce = false
    while autoFruitEnabled do
        if not debounce then
            debounce = true
            for _, fruit in pairs(game.Workspace:GetChildren()) do
                local grabTool = fruit:FindFirstChild("ProximityPrompt") or fruit:FindFirstChild("GrabTool")
                local touchGrabTool = fruit:FindFirstChild("TouchInterest") or fruit.Name:lower():find("fruit") or fruit.Name:lower():find("devilfruit")
                
                if (grabTool or touchGrabTool) and fruit:IsA("BasePart") then
                    local fruitPos = fruit.Position
                    rootPart.CFrame = CFrame.new(fruitPos + Vector3.new(0, 5, 0))
                    wait(1) -- TƒÉng wait ƒë·ªÉ gi·∫£m t·∫£i mobile
                    
                    if grabTool and grabTool:IsA("ProximityPrompt") then
                        fireproximityprompt(grabTool)
                    elseif grabTool and grabTool:IsA("ClickDetector") then
                        fireclickdetector(grabTool)
                    end
                end
            end
            debounce = false
        end
        wait(2) -- TƒÉng wait gi·ªØa c√°c l·∫ßn qu√©t ƒë·ªÉ gi·∫£m t·∫£i
    end
end

-- Th√™m Toggle cho Fast Attack
MainSection:CreateToggle({
    Name = "Fast Attack",
    CurrentValue = false,
    Flag = "FastAttackToggle",
    Callback = function(Value)
        fastAttackEnabled = Value
        if fastAttackEnabled then
            updateCharacter()
            startFastAttack()
        else
            stopFastAttack()
        end
    end
})

-- Th√™m Toggle cho Auto Fruit
MainSection:CreateToggle({
    Name = "Auto Fruit",
    CurrentValue = false,
    Flag = "AutoFruitToggle",
    Callback = function(Value)
        autoFruitEnabled = Value
        if autoFruitEnabled then
            task.spawn(autoFruit)
        end
    end
})

-- Section cho T√πy Ch·ªânh
local CustomizeSection = CustomizeTab:CreateSection("T√πy Ch·ªânh Giao Di·ªán")

-- Th√™m ColorPicker cho M√†u N·ªÅn
CustomizeSection:CreateColorPicker({
    Name = "M√†u N·ªÅn Hub",
    Color = Color3.fromRGB(40, 40, 40),
    Flag = "BackgroundColor",
    Callback = function(Value)
        Window:SetBackgroundColor3(Value)
    end
})

-- Th√™m ColorPicker cho M√†u Ch·ªØ
CustomizeSection:CreateColorPicker({
    Name = "M√†u Ch·ªØ Hub",
    Color = Color3.fromRGB(255, 255, 255),
    Flag = "TextColor",
    Callback = function(Value)
        Window:SetTextColor3(Value)
    end
})

-- Ki·ªÉm tra thay ƒë·ªïi c√¥ng c·ª•
player.Backpack.ChildAdded:Connect(function(child)
    if child:IsA("Tool") and fastAttackEnabled then
        wait(0.1)
        startFastAttack()
    end
end)

character.ChildRemoved:Connect(function(child)
    if child:IsA("Tool") and fastAttackEnabled then
        stopFastAttack()
        fastAttackEnabled = false
    end
end)

-- Kh·ªüi t·∫°o Rayfield UI
Rayfield:LoadConfiguration()

-- T·∫°o ScreenGui cho h√¨nh kh·ªëi bo g√≥c ch·ª©a QR code
local qrScreenGui = Instance.new("ScreenGui")
qrScreenGui.Name = "QRToggle"
qrScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
qrScreenGui.ResetOnSpawn = false

-- T·∫°o h√¨nh kh·ªëi bo g√≥c ch·ª©a QR code (n√∫t b·∫≠t/t·∫Øt UI Rayfield)
local ToggleButton = Instance.new("ImageButton")
ToggleButton.Size = UDim2.new(0, 100, 0, 100) -- H√¨nh kh·ªëi bo g√≥c 100x100
ToggleButton.Position = UDim2.new(0.5, -50, 0.9, -50) -- V·ªã tr√≠ ban ƒë·∫ßu gi·ªØa d∆∞·ªõi m√†n h√¨nh
ToggleButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255) -- N·ªÅn tr·∫Øng
ToggleButton.BorderSizePixel = 0

-- Th√™m g√≥c bo cho h√¨nh kh·ªëi
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0.2, 0) -- Bo g√≥c 20% k√≠ch th∆∞·ªõc
UICorner.Parent = ToggleButton

-- M√¥ ph·ªèng QR code v·ªõi h√¨nh kh·ªëi x√°m v√† ƒë∆∞·ªùng k·∫ª (n·∫øu kh√¥ng c√≥ Decal ID)
local successImage, imageErr = pcall(function()
    ToggleButton.Image = "rbxassetid://6023426915" -- H√¨nh kh·ªëi c∆° b·∫£n (thay b·∫±ng Decal ID n·∫øu c√≥)
end)
if not successImage then
    warn("Kh√¥ng th·ªÉ t·∫£i h√¨nh ·∫£nh QR: " .. imageErr)
    ToggleButton.Image = "" -- X√≥a h√¨nh ·∫£nh n·∫øu l·ªói
    ToggleButton.BackgroundColor3 = Color3.fromRGB(128, 128, 128) -- M√†u x√°m n·∫øu kh√¥ng t·∫£i ƒë∆∞·ª£c h√¨nh
end
ToggleButton.ImageColor3 = Color3.fromRGB(128, 128, 128) -- M√†u x√°m m√¥ ph·ªèng QR
local qrLines = Instance.new("Frame")
qrLines.Size = UDim2.new(0.8, 0, 0.8, 0)
qrLines.Position = UDim2.new(0.1, 0, 0.1, 0)
qrLines.BackgroundTransparency = 1
qrLines.Parent = ToggleButton

local line1 = Instance.new("Frame")
line1.Size = UDim2.new(0.1, 0, 0.8, 0)
line1.Position = UDim2.new(0.2, 0, 0.1, 0)
line1.BackgroundColor3 = Color3.fromRGB(0, 0, 0) -- ƒê∆∞·ªùng ƒëen m√¥ ph·ªèng QR
line1.Parent = qrLines

local line2 = Instance.new("Frame")
line2.Size = UDim2.new(0.8, 0, 0.1, 0)
line2.Position = UDim2.new(0.1, 0, 0.2, 0)
line2.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
line2.Parent = qrLines

ToggleButton.Parent = qrScreenGui

-- Th√™m kh·∫£ nƒÉng di chuy·ªÉn (drag) cho h√¨nh kh·ªëi
local dragging = false
local dragStart = nil
local startPos = nil

ToggleButton.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = ToggleButton.Position
    end
end)

ToggleButton.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.Touch then
        local delta = input.Position - dragStart
        local newX = math.clamp(startPos.X.Offset + delta.X, 0, qrScreenGui.AbsoluteSize.X - ToggleButton.AbsoluteSize.X)
        local newY = math.clamp(startPos.Y.Offset + delta.Y, 0, qrScreenGui.AbsoluteSize.Y - ToggleButton.AbsoluteSize.Y)
        ToggleButton.Position = UDim2.new(0, newX, 0, newY)
    end
end)

game:GetService("UserInputService").InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
    end
end)

-- H√†m b·∫≠t/t·∫Øt UI Rayfield (s·ª≠ d·ª•ng TouchTap cho mobile)
ToggleButton.TouchTap:Connect(function()
    local success, err = pcall(function()
        isUIVisible = not isUIVisible
        if isUIVisible then
            Window:Toggle(true) -- Hi·ªÉn th·ªã UI
        else
            Window:Toggle(false) -- ·∫®n UI
        end
        ToggleButton.ImageColor3 = isUIVisible and Color3.fromRGB(200, 200, 200) or Color3.fromRGB(128, 128, 128) -- Thay ƒë·ªïi m√†u khi nh·∫•n
    end)
    if not success then
        warn("L·ªói b·∫≠t/t·∫Øt UI: " .. err)
    end
end)
